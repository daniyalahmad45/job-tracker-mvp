<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered Job Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f8f9fa;
      padding: 20px;
    }

    .header {
      background: white;
      padding: 20px 30px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    h1 {
      color: #1a1a1a;
      font-size: 24px;
      margin-bottom: 15px;
    }

    .profile-section {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .profile-section h3 {
      font-size: 14px;
      color: #0c4a6e;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .profile-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .profile-inputs textarea {
      grid-column: 1 / -1;
    }

    .fetch-section {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    .input-wrapper {
      flex: 1;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      font-weight: 500;
      color: #555;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
      font-family: inherit;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: #2563eb;
    }

    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
      white-space: nowrap;
    }

    button:hover {
      background: #1d4ed8;
    }

    button:disabled {
      background: #94a3b8;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #64748b;
    }

    .btn-secondary:hover {
      background: #475569;
    }

    .btn-success {
      background: #16a34a;
    }

    .btn-success:hover {
      background: #15803d;
    }

    .btn-delete {
      background: #dc2626;
    }

    .btn-delete:hover {
      background: #b91c1c;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }

    .status-message {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 13px;
      display: none;
    }

    .status-message.success {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
    }

    .status-message.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
    }

    .status-message.info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #bfdbfe;
    }

    .controls {
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .stats {
      display: flex;
      gap: 20px;
      margin-left: auto;
      font-size: 13px;
      color: #6b7280;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-number {
      font-weight: 600;
      color: #1f2937;
    }

    .table-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    thead {
      background: #f8f9fa;
      border-bottom: 2px solid #e5e7eb;
    }

    th {
      text-align: left;
      padding: 12px 16px;
      font-weight: 600;
      color: #374151;
      white-space: nowrap;
    }

    tbody tr {
      border-bottom: 1px solid #f3f4f6;
      transition: background 0.15s;
    }

    tbody tr:hover {
      background: #f9fafb;
    }

    tbody tr.filtered-out {
      opacity: 0.4;
      background: #fef2f2;
    }

    td {
      padding: 12px 16px;
      color: #1f2937;
    }

    .cell-checkbox {
      width: 40px;
      text-align: center;
    }

    .cell-checkbox input {
      cursor: pointer;
    }

    .cell-company {
      font-weight: 500;
      min-width: 120px;
    }

    .cell-title {
      min-width: 200px;
    }

    .cell-location {
      min-width: 120px;
      color: #6b7280;
    }

    .cell-relevance {
      min-width: 100px;
    }

    .cell-status {
      min-width: 130px;
    }

    .cell-date {
      min-width: 110px;
    }

    .cell-notes {
      min-width: 200px;
    }

    .cell-actions {
      min-width: 120px;
      text-align: right;
    }

    select, input[type="date"] {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
    }

    td textarea {
      width: 100%;
      min-height: 40px;
      max-height: 100px;
      padding: 6px 8px;
    }

    .relevance-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .relevance-high {
      background: #dcfce7;
      color: #166534;
    }

    .relevance-medium {
      background: #fef3c7;
      color: #92400e;
    }

    .relevance-low {
      background: #fee2e2;
      color: #991b1b;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
    }

    .empty-state h3 {
      font-size: 18px;
      margin-bottom: 8px;
      color: #374151;
    }

    .ai-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: #7c3aed;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .filter-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #f3f4f6;
      border-radius: 6px;
      font-size: 13px;
    }

    .filter-toggle input[type="checkbox"] {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ü§ñ AI-Powered Job Tracker</h1>
    
    <div class="profile-section">
      <h3>
        <span>‚ú® Your Profile</span>
        <span style="font-weight: normal; font-size: 12px;">(AI will use this to filter relevant jobs)</span>
      </h3>
      <div class="profile-inputs">
        <div>
          <label for="userMajor">Your Major/Field:</label>
          <input type="text" id="userMajor" placeholder="e.g., Computer Science, Data Science, Marketing">
        </div>
        <div>
          <label for="userLevel">Experience Level:</label>
          <input type="text" id="userLevel" placeholder="e.g., Entry Level, Mid-Level, Senior">
        </div>
        <div>
          <label for="userSkills">Skills & Interests:</label>
          <textarea id="userSkills" placeholder="e.g., Python, Machine Learning, Web Development, React, Data Analysis..."></textarea>
        </div>
      </div>
    </div>

    <div class="fetch-section">
      <div class="input-wrapper">
        <label for="companyUrl">Company Careers Page URL:</label>
        <input 
          type="text" 
          id="companyUrl" 
          placeholder="https://boards.greenhouse.io/discord or https://jobs.lever.co/netflix"
        >
      </div>
      <button onclick="fetchAndFilterJobs()" id="fetchBtn">üîç Fetch & Filter Jobs</button>
    </div>
    <div id="statusMsg" class="status-message"></div>
  </div>

  <div class="controls">
    <button onclick="addManualJob()" class="btn-success btn-small">+ Add Manually</button>
    <button onclick="deleteSelected()" class="btn-delete btn-small">Delete Selected</button>
    <button onclick="exportData()" class="btn-secondary btn-small">Export CSV</button>
    
    <div class="filter-toggle">
      <input type="checkbox" id="hideFiltered" onchange="renderTable()">
      <label for="hideFiltered" style="margin: 0; cursor: pointer;">Hide Low Relevance Jobs</label>
    </div>
    
    <div class="filter-toggle">
      <input type="checkbox" id="showOnlyHigh" onchange="renderTable()">
      <label for="showOnlyHigh" style="margin: 0; cursor: pointer;">Show Only High Relevance</label>
    </div>
    
    <div class="stats">
      <div class="stat-item">
        <span>Total:</span>
        <span class="stat-number" id="totalCount">0</span>
      </div>
      <div class="stat-item">
        <span>Relevant:</span>
        <span class="stat-number" id="relevantCount">0</span>
      </div>
      <div class="stat-item">
        <span>Applied:</span>
        <span class="stat-number" id="appliedCount">0</span>
      </div>
    </div>
  </div>

  <div class="table-container">
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th class="cell-checkbox">
              <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
            </th>
            <th class="cell-company">Company</th>
            <th class="cell-title">Job Title</th>
            <th class="cell-location">Location</th>
            <th class="cell-relevance">AI Match</th>
            <th class="cell-status">Status</th>
            <th class="cell-date">Applied Date</th>
            <th class="cell-notes">Notes</th>
            <th class="cell-actions">Actions</th>
          </tr>
        </thead>
        <tbody id="jobTableBody">
          <tr>
            <td colspan="9">
              <div class="empty-state">
                <h3>No jobs tracked yet</h3>
                <p>1. Fill in your profile above<br>2. Enter a company careers page URL<br>3. Click "Fetch & Filter Jobs"</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let jobs = [];
    let nextId = 1;

    // Load profile and jobs
    function loadData() {
      const savedProfile = localStorage.getItem('userProfile');
      if (savedProfile) {
        const profile = JSON.parse(savedProfile);
        document.getElementById('userMajor').value = profile.major || '';
        document.getElementById('userLevel').value = profile.level || '';
        document.getElementById('userSkills').value = profile.skills || '';
      }

      const savedJobs = localStorage.getItem('jobTrackerJobs');
      if (savedJobs) {
        const data = JSON.parse(savedJobs);
        jobs = data.jobs || [];
        nextId = data.nextId || 1;
      }

      renderTable();
      updateStats();
    }

    function saveProfile() {
      localStorage.setItem('userProfile', JSON.stringify({
        major: document.getElementById('userMajor').value,
        level: document.getElementById('userLevel').value,
        skills: document.getElementById('userSkills').value
      }));
    }

    function saveJobs() {
      localStorage.setItem('jobTrackerJobs', JSON.stringify({
        jobs: jobs,
        nextId: nextId
      }));
      updateStats();
    }

    // Save profile on change
    ['userMajor', 'userLevel', 'userSkills'].forEach(id => {
      document.getElementById(id).addEventListener('change', saveProfile);
    });

    async function fetchAndFilterJobs() {
      const url = document.getElementById('companyUrl').value.trim();
      const major = document.getElementById('userMajor').value.trim();
      const level = document.getElementById('userLevel').value.trim();
      const skills = document.getElementById('userSkills').value.trim();

      if (!url) {
        showStatus('Please enter a company careers page URL', 'error');
        return;
      }

      if (!major && !skills) {
        showStatus('Please fill in your major or skills so AI can filter relevant jobs', 'error');
        return;
      }

      saveProfile();

      const fetchBtn = document.getElementById('fetchBtn');
      fetchBtn.disabled = true;
      showStatus('Fetching jobs from company...', 'info');

      try {
        // Step 1: Fetch jobs from the company
        const fetchedJobs = await mockFetchJobs(url);
        
        if (!fetchedJobs.success) {
          showStatus('Error: ' + fetchedJobs.error, 'error');
          return;
        }

        showStatus(`Found ${fetchedJobs.jobs.length} jobs. AI is analyzing relevance... ü§ñ`, 'info');

        // Step 2: Use AI to filter and score relevance
        const company = extractCompanyName(url);
        const filteredJobs = await analyzeJobsWithAI(fetchedJobs.jobs, { major, level, skills }, company);

        // Step 3: Add to spreadsheet
        filteredJobs.forEach(job => {
          jobs.push({
            id: nextId++,
            company: company,
            title: job.title,
            location: job.location,
            url: job.url,
            relevance: job.relevance,
            aiReason: job.reason,
            status: 'Not Applied',
            appliedDate: '',
            notes: job.reason || '',
            selected: false
          });
        });

        saveJobs();
        renderTable();
        
        const relevant = filteredJobs.filter(j => j.relevance === 'High' || j.relevance === 'Medium').length;
        showStatus(`‚úÖ Added ${filteredJobs.length} jobs (${relevant} highly relevant to your profile)`, 'success');
        document.getElementById('companyUrl').value = '';

      } catch (error) {
        showStatus('Error: ' + error.message, 'error');
      } finally {
        fetchBtn.disabled = false;
      }
    }

    // AI Analysis - calls backend server
    async function analyzeJobsWithAI(jobList, profile, company) {
      console.log('Sending jobs to backend for AI analysis...');
      
      try {
        const response = await fetch('http://localhost:3000/api/analyze-jobs', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            jobs: jobList,
            profile: profile,
            company: company
          })
        });

        const data = await response.json();
        
        if (!response.ok || !data.success) {
          console.warn('Backend AI analysis failed, using fallback');
          throw new Error(data.error || 'Analysis failed');
        }

        console.log('‚úÖ AI analysis successful! Received', data.analysis.length, 'results');

        // Merge AI analysis with original jobs
        return jobList.map((job, idx) => {
          const aiResult = data.analysis.find(j => j.index === idx + 1);
          
          if (aiResult) {
            return {
              ...job,
              relevance: aiResult.relevance,
              reason: aiResult.reason
            };
          } else {
            return {
              ...job,
              relevance: 'Medium',
              reason: 'Analysis incomplete - check manually'
            };
          }
        });

      } catch (error) {
        console.error('‚ö†Ô∏è AI analysis not available:', error.message);
        console.log('Using enhanced keyword matching as fallback...');
        
        // Enhanced fallback with better keyword matching
        return jobList.map(job => {
          const title = job.title.toLowerCase();
          const majorLower = (profile.major || '').toLowerCase();
          const skillsLower = (profile.skills || '').toLowerCase();
          
          let relevance = 'Medium';
          let reason = 'Manual review recommended';
          
          // Data Science matching
          if (majorLower.includes('data science') || majorLower.includes('data')) {
            if (title.includes('data scientist') || title.includes('machine learning')) {
              relevance = 'High';
              reason = 'Direct match for Data Science role';
            } else if (title.includes('data engineer') || title.includes('data analyst') || title.includes('analytics')) {
              relevance = 'Medium';
              reason = 'Data-related role, good fit';
            } else if (title.includes('software') || title.includes('engineer')) {
              relevance = 'Low';
              reason = 'Software engineering, not data-focused';
            } else {
              relevance = 'Low';
              reason = 'Not data-related';
            }
          }
          // Computer Science matching
          else if (majorLower.includes('computer') || majorLower.includes('software')) {
            if (title.includes('engineer') || title.includes('developer') || title.includes('software')) {
              relevance = 'High';
              reason = 'Technical role matches CS background';
            } else if (title.includes('data') || title.includes('analyst')) {
              relevance = 'Medium';
              reason = 'Technical adjacent role';
            } else {
              relevance = 'Low';
              reason = 'Non-technical role';
            }
          }
          
          return {
            ...job,
            relevance: relevance,
            reason: reason
          };
        });
      }
    }

    // Real API fetch function
    async function mockFetchJobs(url) {
      try {
        const response = await fetch('http://localhost:3000/api/fetch-jobs', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ url: url })
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();
        return data;

      } catch (error) {
        console.error('Fetch error:', error);
        return {
          success: false,
          error: error.message || 'Failed to connect to server. Make sure your backend is running on localhost:3000'
        };
      }
    }

    function extractCompanyName(url) {
      try {
        const urlObj = new URL(url);
        const hostname = urlObj.hostname;
        const pathname = urlObj.pathname;
        
        // Greenhouse: boards.greenhouse.io/discord
        if (hostname.includes('greenhouse.io')) {
          const match = pathname.match(/\/([^\/]+)/);
          if (match && match[1] && match[1] !== 'embed') {
            return capitalizeCompanyName(match[1]);
          }
        }
        
        // Lever: jobs.lever.co/netflix
        if (hostname.includes('lever.co')) {
          const match = pathname.match(/\/([^\/]+)/);
          if (match && match[1]) {
            return capitalizeCompanyName(match[1]);
          }
        }
        
        // Workday: company.wd1.myworkdayjobs.com or company.myworkdayjobs.com
        if (hostname.includes('myworkdayjobs.com')) {
          const parts = hostname.split('.');
          return capitalizeCompanyName(parts[0]);
        }
        
        // Apple: jobs.apple.com
        if (hostname.includes('jobs.apple.com') || hostname === 'jobs.apple.com') {
          return 'Apple';
        }
        
        // Amazon: amazon.jobs
        if (hostname.includes('amazon.jobs')) {
          return 'Amazon';
        }
        
        // Adobe: careers.adobe.com
        if (hostname.includes('careers.adobe.com')) {
          return 'Adobe';
        }
        
        // Generic: Try to extract from subdomain or main domain
        const domainParts = hostname.split('.');
        
        // careers.company.com or jobs.company.com
        if (domainParts[0] === 'careers' || domainParts[0] === 'jobs') {
          if (domainParts.length > 2) {
            return capitalizeCompanyName(domainParts[1]);
          }
        }
        
        // company.com
        if (domainParts.length >= 2) {
          return capitalizeCompanyName(domainParts[domainParts.length - 2]);
        }
        
        return 'Company';
      } catch {
        return 'Company';
      }
    }
    
    function capitalizeCompanyName(name) {
      // Remove hyphens and underscores, capitalize properly
      return name
        .replace(/[-_]/g, ' ')
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
        .join(' ');
    }

    function addManualJob() {
      jobs.push({
        id: nextId++,
        company: '',
        title: '',
        location: '',
        url: '',
        relevance: 'High',
        aiReason: '',
        status: 'Not Applied',
        appliedDate: '',
        notes: 'Manually added - review and apply',
        selected: false
      });
      saveJobs();
      renderTable();
    }

    function updateJob(id, field, value) {
      const job = jobs.find(j => j.id === id);
      if (job) {
        job[field] = value;
        saveJobs();
        renderTable();
      }
    }

    function deleteJob(id) {
      jobs = jobs.filter(j => j.id !== id);
      saveJobs();
      renderTable();
    }

    function deleteSelected() {
      const selected = jobs.filter(j => j.selected);
      if (selected.length === 0) {
        showStatus('No jobs selected', 'error');
        return;
      }

      if (confirm(`Delete ${selected.length} job(s)?`)) {
        jobs = jobs.filter(j => !j.selected);
        saveJobs();
        renderTable();
        showStatus(`Deleted ${selected.length} job(s)`, 'success');
      }
    }

    function toggleSelect(id) {
      const job = jobs.find(j => j.id === id);
      if (job) job.selected = !job.selected;
    }

    function toggleSelectAll() {
      const checked = document.getElementById('selectAll').checked;
      jobs.forEach(j => j.selected = checked);
      renderTable();
    }

    function renderTable() {
      const tbody = document.getElementById('jobTableBody');
      const hideFiltered = document.getElementById('hideFiltered')?.checked;
      const showOnlyHigh = document.getElementById('showOnlyHigh')?.checked;
      
      if (jobs.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9">
              <div class="empty-state">
                <h3>No jobs tracked yet</h3>
                <p>1. Fill in your profile above<br>2. Enter a company careers page URL<br>3. Click "Fetch & Filter Jobs"</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      let visibleJobs = jobs;
      
      // Apply filters
      if (showOnlyHigh) {
        visibleJobs = visibleJobs.filter(j => j.relevance === 'High');
      } else if (hideFiltered) {
        visibleJobs = visibleJobs.filter(j => j.relevance !== 'Low');
      }

      if (visibleJobs.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9">
              <div class="empty-state">
                <h3>No jobs match your filters</h3>
                <p>Try adjusting the filters or checking if your profile matches the available positions</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = visibleJobs.map(job => {
        const relevanceClass = job.relevance === 'High' ? 'relevance-high' : 
                              job.relevance === 'Medium' ? 'relevance-medium' : 
                              'relevance-low';
        
        return `
          <tr class="${job.relevance === 'Low' ? 'filtered-out' : ''}">
            <td class="cell-checkbox">
              <input type="checkbox" ${job.selected ? 'checked' : ''} 
                onchange="toggleSelect(${job.id}); renderTable()">
            </td>
            <td class="cell-company">
              <input type="text" value="${job.company}" 
                onchange="updateJob(${job.id}, 'company', this.value)">
            </td>
            <td class="cell-title">
              <input type="text" value="${job.title}" 
                onchange="updateJob(${job.id}, 'title', this.value)">
            </td>
            <td class="cell-location">${job.location}</td>
            <td class="cell-relevance">
              <span class="relevance-badge ${relevanceClass}">${job.relevance}</span>
            </td>
            <td class="cell-status">
              <select onchange="updateJob(${job.id}, 'status', this.value)">
                <option value="Not Applied" ${job.status === 'Not Applied' ? 'selected' : ''}>Not Applied</option>
                <option value="Applied" ${job.status === 'Applied' ? 'selected' : ''}>Applied</option>
                <option value="Interview" ${job.status === 'Interview' ? 'selected' : ''}>Interview</option>
                <option value="Offer" ${job.status === 'Offer' ? 'selected' : ''}>Offer</option>
                <option value="Rejected" ${job.status === 'Rejected' ? 'selected' : ''}>Rejected</option>
              </select>
            </td>
            <td class="cell-date">
              <input type="date" value="${job.appliedDate}" 
                onchange="updateJob(${job.id}, 'appliedDate', this.value)">
            </td>
            <td class="cell-notes">
              <textarea onchange="updateJob(${job.id}, 'notes', this.value)">${job.notes}</textarea>
            </td>
            <td class="cell-actions">
              ${job.url ? `<a href="${job.url}" target="_blank" class="btn-secondary btn-small" style="display: inline-block; text-decoration: none; margin-bottom: 4px;">View Job</a><br>` : ''}
              <button onclick="deleteJob(${job.id})" class="btn-delete btn-small">Delete</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function updateStats() {
      document.getElementById('totalCount').textContent = jobs.length;
      document.getElementById('relevantCount').textContent = 
        jobs.filter(j => j.relevance === 'High' || j.relevance === 'Medium').length;
      document.getElementById('appliedCount').textContent = 
        jobs.filter(j => j.status === 'Applied').length;
    }

    function showStatus(message, type) {
      const statusMsg = document.getElementById('statusMsg');
      statusMsg.textContent = message;
      statusMsg.className = 'status-message ' + type;
      statusMsg.style.display = 'block';
      
      if (type !== 'info') {
        setTimeout(() => {
          statusMsg.style.display = 'none';
        }, 5000);
      }
    }

    function exportData() {
      if (jobs.length === 0) {
        showStatus('No jobs to export', 'error');
        return;
      }

      const headers = ['Company', 'Job Title', 'Location', 'AI Relevance', 'Status', 'Applied Date', 'Notes', 'AI Reason', 'URL'];
      const rows = jobs.map(job => [
        job.company,
        job.title,
        job.location,
        job.relevance,
        job.status,
        job.appliedDate,
        job.notes,
        job.aiReason || '',
        job.url
      ]);

      const csvContent = [
        headers.join(','),
        ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
      ].join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `job-tracker-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);

      showStatus('Exported successfully', 'success');
    }

    document.getElementById('companyUrl').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') fetchAndFilterJobs();
    });

    loadData();
  </script>
</body>
</html>